!function(e,a){if("object"==typeof exports&&"object"==typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var t=a();for(var s in t)("object"==typeof exports?exports:e)[s]=t[s]}}("undefined"!=typeof self?self:this,function(){return function(e){function a(s){if(t[s])return t[s].exports;var n=t[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,a),n.l=!0,n.exports}var t={};return a.m=e,a.c=t,a.d=function(e,t,s){a.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:s})},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,a){return Object.prototype.hasOwnProperty.call(e,a)},a.p="",a(a.s=30)}([function(e,a){e.exports=_xe_bundle_common},function(e,a,t){e.exports=t(2)(184)},function(e,a){e.exports=_xe_bundle_vendor},function(e,a,t){e.exports=t(0)(2)},function(e,a,t){e.exports=t(0)(6)},function(e,a,t){e.exports=t(0)(377)},,,,,function(e,a,t){e.exports={default:t(11),__esModule:!0}},function(e,a,t){var s=t(12),n=s.JSON||(s.JSON={stringify:JSON.stringify});e.exports=function(e){return n.stringify.apply(n,arguments)}},function(e,a,t){e.exports=t(0)(0)},,,,,,,,,,,,,,,,,,function(e,a,t){e.exports=t(31)},function(e,a,t){var s,n,i;!function(r,l){n=[t(10),t(3),t(4),t(1),t(5)],s=l,void 0!==(i="function"==typeof s?s.apply(a,n):s)&&(e.exports=i)}(0,function(e,a,t,s,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}var r=i(e),l=i(a),o=i(t),c=i(s),u=i(n),p={ENTER:13,TAB:9,BACKSPACE:8,UP_ARROW:38,DOWN_ARROW:40,ESCAPE:27},d=function(){function e(a){var t=a.$wrapper,s=a.key,n=a.userSearchUrl,i=a.groupSearchUrl,r=a.permission,o=a.type,c=a.vgroupAll;(0,l.default)(this,e),this.$wrapper=t,this.key=s,this.userSearchUrl=n,this.groupSearchUrl=i,this.permission=r,this.type=o,this.vgroupAll=c,this.query="",this.suggestion=[],this.placeholder=u.default.Lang.trans("xe::explainIncludeUserOrGroup"),this.selectedIndex="",this.includeSelectedIndex=-1,this.excludeSelectedIndex=-1,this.MIN_QUERY_LENGTH=2}return(0,o.default)(e,[{key:"bindEvents",value:function(){var e=this;this.$wrapper.on("change",".chkModeAble",function(a){(0,c.default)(a.target).is(":checked")?e.$wrapper.find("input:not(.chkModeAble)").prop("disabled",!0):e.$wrapper.find("input:not(.chkModeAble)").prop("disabled",!1)}),this.$wrapper.on("keydown",".inputUserGroup",function(a){var t=a.target.value.trim(),s=(0,c.default)(this),n=a.keyCode,i=s.parent().find(".ReactTags__suggestions ul"),r=s.data("input");if(t.length>=e.MIN_QUERY_LENGTH){if(i.length>0){var l=parseInt(s.data("index"),10),o=0;switch(n){case p.UP_ARROW:o=0==l?i.find("li").length-1:l-1,s.data("index",o),i.find("li").eq(o).addClass("active").siblings().removeClass("active");break;case p.DOWN_ARROW:o=l==i.find("li").length-1?0:l+1,s.data("index",o),i.find("li").eq(o).addClass("active").siblings().removeClass("active");break;case p.ENTER:case p.TAB:if(a.preventDefault(),i.find("li.active").length>0){var u=i.find("li.active").data("tag"),d="",f="",g="";"user"==i.data("target")?"include"==r?(d=e.type+"User",f="user",g="@"):(d=e.type+"Except",f="except",g="@"):(d=e.type+"Group",f="group",g="%");var v=e.permission[f],h=!1;v.length>0?(v.forEach(function(e,a){e.id===u.id&&(h=!0)}),h||e.permission[f].push(u)):e.permission[f].push(u);var m=e.permission[f].map(function(e){return e.id});h||(i.closest(".ReactTags__tags").find("[name="+d+"]").val(m.join().trim()),i.closest(".ReactTags__tags").find("."+f+"Wrap").append('<span class="ReactTags__tag">'+(g+(u.display_name||u.name))+'<a class="ReactTags__remove btnRemoveTag" data-id="'+u.id+'">x</a></span>')),i.remove(),s.val("").data("index",-1).focus()}a.preventDefault();break;case p.ESCAPE:e[r+"SelectedIndex"]=0,i.parent().empty(),s.focus()}}}else if(p.BACKSPACE===n){var _=s.closest(".ReactTags__tags").find(".ReactTags__selected span");!t&&_.length>0&&e.removeTag(_.eq(_.length-1))}}),this.$wrapper.find(".ReactTags__suggestions").on("mouseenter","li",function(){var e=(0,c.default)(this);e.closest("ul");e.addClass("active").siblings().removeClass("active")}),this.$wrapper.find(".ReactTags__suggestions").on("click","li",function(){var a=(0,c.default)(this),t=a.data("tag"),s=a.closest("ul"),n=a.closest(".ReactTags__tagInput").find("input:text"),i=n.data("input"),r=(t.id,""),l="",o="";"user"==s.data("target")?"include"==i?(r=e.type+"User",l="user",o="@"):(r=e.type+"Except",l="except",o="@"):(r=e.type+"Group",l="group",o="%");var u=e.permission[l],p=!1;u.length>0?(u.forEach(function(e,a){e.id===t.id&&(p=!0)}),p||e.permission[l].push(t)):e.permission[l].push(t);var d=e.permission[l].map(function(e){return e.id});p||(s.closest(".ReactTags__tags").find("[name="+r+"]").val(d.join().trim()),s.closest(".ReactTags__tags").find("."+l+"Wrap").append('<span class="ReactTags__tag">'+(o+(t.display_name||t.name))+'<a class="ReactTags__remove btnRemoveTag" data-id="'+t.id+'">x</a></span>')),s.remove(),n.val("").data("index",-1).focus()}),this.$wrapper.on("keyup",".inputUserGroup",function(a){var t=a.target.value.trim(),s=(0,c.default)(this),n=a.keyCode;if(t.length>=e.MIN_QUERY_LENGTH){if(-1==[p.ENTER,p.TAB,p.UP_ARROW,p.DOWN_ARROW,p.ESCAPE,37,39].indexOf(n)){var i="";i+="<ul>",i+='<li>Searching ... <span class="spinner" role="spinner"><span class="spinner-icon"></span></span></li>',i+="</ul>",s.parent().find(".ReactTags__suggestions").html(i);var r=t.substr(0,1);switch(r){case"@":t=t.substr(1,t.length),e.searchUser(s,t);break;case"%":t=t.substr(1,t.length),e.searchGroup(s,t)}}}else s.parent().find(".ReactTags__suggestions").empty()}),this.$wrapper.on("click",".btnRemoveTag",function(a){a.preventDefault(),e.removeTag((0,c.default)(this).closest("span"))})}},{key:"makeIt",value:function(e,a){var t=a.trim().replace(/[-\\^$*+?.()|[\]{}]/g,"\\$&"),s=RegExp(t,"gi");return(e.display_name||e.name).replace(s,"<mark>$&</mark>")}},{key:"removeTag",value:function(e){var a=this,t=e.closest(".ReactTags__selected").data("ptype"),s=e.data("id"),n="";switch(t){case"user":n=a.type+"User";break;case"except":n=a.type+"Except";break;case"group":n=a.type+"Group"}a.permission[t].forEach(function(e,n){e.id!==s&&a.permission[t].splice(n,1)});var i=a.permission[t].map(function(e){return e.id});e.closest(".ReactTags__tags").find("[name="+n+"]").val(i.join().trim()),e.remove()}},{key:"searchUser",value:function(e,a){var t=this,s=t.userSearchUrl;u.default.ajax({url:s+"/"+a,method:"get",dataType:"json",cache:!1,success:function(s){if(s.length>0){var n="";n+='<ul data-target="user">',s.forEach(function(e,s){n+='<li class="" data-tag=\''+(0,r.default)(e)+"'>",n+="<span>"+t.makeIt(e,a)+"</span>",n+="</li>"}),n+="</ul>",e.parent().find(".ReactTags__suggestions").html(n)}else e.parent().find(".ReactTags__suggestions").empty()},error:function(e,a,t){}})}},{key:"searchGroup",value:function(e,a){var t=this,s=t.groupSearchUrl;u.default.ajax({url:s+"/"+a,method:"get",dataType:"json",cache:!1,success:function(s){if(console.log(s),s.length>0){var n="";n+='<ul data-target="group">',s.forEach(function(e,s){n+="<li data-tag='"+(0,r.default)(e)+"'>",n+="<span>"+t.makeIt(e,a)+"</span>",n+="</li>"}),n+="</ul>",e.parent().find(".ReactTags__suggestions").html(n)}else e.parent().find(".ReactTags__suggestions").empty()},error:function(e,a,t){}})}},{key:"render",value:function(){var e=this,a=this.permission.mode,t=this.permission.rating,s=!1,n=[{value:"super",name:u.default.Lang.trans("xe::userRatingAdministrator")},{value:"manager",name:u.default.Lang.trans("xe::userRatingManager")},{value:"user",name:u.default.Lang.trans("xe::user")},{value:"guest",name:u.default.Lang.trans("xe::guest")}],i=!1;"manual"!==a&&"inherit"!==a||(s=!0,"manual"!==a&&(i=!0));var r=this.permission.group.map(function(e){return e.id}),l=this.permission.user.map(function(e){return e.id}),o=this.permission.except.map(function(e){return e.id}),c="";if(c+="<div>",s){var p="inherit"===a?'checked="checked"':"";c+='<div class="form-group">',c+='<div class="checkbox">',c+='<label><input type="checkbox" name="'+this.type+'Mode" class="chkModeAble" value="inherit" '+p+" /> "+u.default.Lang.trans("xe::inheritMode")+"</label>",c+="</div>",c+="</div>"}c+='<div class="form-group">',c+="<label>회원 등급</label>",c+='<div class="radio">',n.forEach(function(a){var s=a.value==t?"checked":"";c+='<label><input type="radio" '+(i?'disabled="disabled"':"")+' name="'+e.type+'Rating" value="'+a.value+'" '+(s?'checked="checked"':"")+" /> "+a.name+" &nbsp;</label>"}),c+="</div>",c+="</div>",c+='<div class="form-group">',c+="<label>"+u.default.Lang.trans("xe::includeUserOrGroup")+"</label>",c+='<div class="ReactTags__tags">',c+='<div class="ReactTags__selected groupWrap" data-ptype="group">',this.permission.group.forEach(function(e){var a=e,t="%"+(a.display_name||a.name);c+='<span class="ReactTags__tag">'+t+'<a href="#" class="ReactTags__remove btnRemoveTag" data-id="'+a.id+'">x</a></span>'}),c+="</div>",c+='<div class="ReactTags__selected userWrap" data-ptype="user">',this.permission.user.forEach(function(e){var a="@"+(e.display_name||e.name);c+='<span class="ReactTags__tag">'+a+'<a href="#" class="ReactTags__remove btnRemoveTag" data-id="'+e.id+'|">x</a></span>'}),c+="</div>",c+='<div class="ReactTags__tagInput">',c+='<input type="text" placeholder="'+this.placeholder+'" class="form-control inputUserGroup" data-input="include" '+(i?'disabled="disabled"':"")+' value="'+this.query+'" data-index="-1" />',c+='<div class="ReactTags__suggestions" data-input="include"></div>',c+="</div>",c+='<input type="hidden" name="'+this.type+'Group" class="form-control includeGroups" value="'+r.join().trim()+'" />',c+='<input type="hidden" name="'+this.type+'User" class="form-control includeUsers" value="'+l.join().trim()+'" />',c+="</div>",c+="</div>",this.vgroupAll.length>=1&&(c+='<div class="form-group">',c+="<label>"+u.default.Lang.trans("xe::includeVGroup")+"</label>",c+=e.vgroupAll.map(function(a){var t=!1;return-1!=function(e,a){for(var t=0;t<a.length;t++)if(a[t]==e)return t;return-1}(a.id,this.permission.vgroup)&&(t=!0),'<label><input type="checkbox" '+(i?'disabled="disabled"':"")+' name="'+e.type+'VGroup[]" value="'+a.id+'" '+(t?'checked="checked"':"")+" /> "+a.title+" &nbsp;</label>"}),c+="</div>"),c+='<div class="form-group">',c+="<label>"+u.default.Lang.trans("xe::excludeUser")+"</label>",c+='<div class="ReactTags__tags">',c+='<div class="ReactTags__selected exceptWrap" data-ptype="except">',this.permission.except.forEach(function(e){var a=e.display_name||e.name;a="@"+a,c+='<span class="ReactTags__tag">'+a+'<a href="#" class="ReactTags__remove btnRemoveTag" data-id="'+e.id+'">x</a></span>'}),c+="</div>",c+='<div class="ReactTags__tagInput">',c+='<input type="text" placeholder="'+u.default.Lang.trans("xe::explainExcludeUser")+'" class="form-control inputUserGroup" data-input="exclude" '+(i?'disabled="disabled"':"")+' data-index="-1" />',c+='<div class="ReactTags__suggestions" data-input="exclude"></div>',c+="</div>",c+='<input type="hidden" name="'+this.type+'Except" class="form-control excludeUsers" value="'+o+'" />',c+="</div>",c+="</div>",c+="</div>",this.$wrapper.html(c)}}]),e}();(0,c.default)(".__xe__uiobject_permission").each(function(e){var a=(0,c.default)(this),t=a.data("data"),s=a.data("key"),n=a.data("type"),i=a.data("userUrl"),r=a.data("groupUrl"),l=a.data("vgroupAll"),o=new d({$wrapper:a,key:s,userSearchUrl:i,groupSearchUrl:r,permission:t,type:n,vgroupAll:l});o.render(),o.bindEvents()})})}])});
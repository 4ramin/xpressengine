!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var a=e();for(var n in a)("object"==typeof exports?exports:t)[n]=a[n]}}("undefined"!=typeof self?self:this,function(){return function(t){function e(n){if(a[n])return a[n].exports;var i=a[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var a={};return e.m=t,e.c=a,e.d=function(t,a,n){e.o(t,a)||Object.defineProperty(t,a,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var a=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(a,"a",a),a},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=56)}({0:function(t,e){t.exports=_xe_bundle_common},56:function(t,e,a){t.exports=a(57)},57:function(t,e,a){"use strict";var n=a(58);!function(t,e){function a(t,a,n,i,s,o){return this.key=a,this.elem=t,this.callback=n,this.withForm=i,this.container=s,this.apiUrl=o,this.interval=null,this.draftId=null,this.component=null,this.$component=e(),this.componentName="",this.uid=null,e(this.elem).attr("name")&&""!=e(this.elem).attr("name")?(this.init(),this.bindEvents(),this):void console.error("Must set 'name' attribute ")}a.prototype={init:function(){this.uid=this._getUid(),this.appendComponent(),t.Lang.requestTransAll(["xe::draftSave","xe::draftSaved","xe::autoSave","xe::draftLoad"])},_getUid:function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},bindEvents:function(){var t=this;e(this.elem).on("input.draft",function(){t.saveEventHandler()}),t.$component.on("click",".draft_title",function(a){a.preventDefault();var n=e(this),i=n.data("type"),s=e(this).data("item");switch(t.onApply(s),i){case"modal":t.$component.xeModal("hide");break;case"collapse":t.$component.show().find(".panel-body").empty()}}),t.$component.on("click",".xe-draftBtnCloseModal",function(){t.$component.xeModal("hide")}),t.$component.on("click",".btn_draft_delete",function(a){a.preventDefault();var n=e(this),i=n.data("id");t.reqDelete(i,function(){n.closest("li").remove()})}),(0,n.getForm)(e(t.elem).closest("form")).$$on("submit",function(){return t.deleteAuto(t.autoDraftId)},{name:"xe.draft"})},toggle:function(a){var n=this;switch(this.componentName){case"modal":!a&&n.$component.hasClass("in")?n.$component.xeModal("hide"):n.load({key:n.key},function(a){var i='<div class="draft_save_list">';i+="<ul>",a.forEach(function(a,n){i+="<li>",i+="<a href='#' class='draft_title' data-item='"+JSON.stringify(a)+'\' data-type="modal">'+e(e.parseHTML(a.val)).text()+"</a>",i+='<div class="draft_info">',1==a.is_auto?i+='<span class="draft_state">'+t.Lang.trans("xe::autoSave")+"</span>":i+='<span class="draft_state v2">'+t.Lang.trans("xe::draftSave")+"</span>",i+='<span class="draft_date">'+a.created_at.substr(0,16).replace(/-/g," ")+"</span>",i+='<a href="#" class="btn_draft_delete" data-id="'+a.id+'"><i class="xi-close"></i></a>',i+="</div>",i+="</li>"}),i+="</ul>",i+="</div>",n.$component.find(".xe-modal-body").html(i),n.$component.xeModal("show")});break;case"collapse":!a&&n.$component.hasClass("in")?n.$component.hide():n.load({key:n.key},function(a){var i='<div class="draft_save_list">';i+="<ul>",a.forEach(function(a,n){i+="<li>",i+="<a href='#' class='draft_title' data-item='"+JSON.stringify(a)+'\' data-type="collapse">'+e(e.parseHTML(a.val)).text()+"</a>",i+='<div class="draft_info">',1==a.is_auto?i+='<span class="draft_state">'+t.Lang.trans("xe::autoSave")+"</span>":i+='<span class="draft_state v2">'+t.Lang.trans("xe::draftSave")+"</span>",i+='<span class="draft_date">'+a.created_at.substr(0,16).replace(/-/g," ")+"</span>",i+='<a href="#" class="btn_draft_delete" data-id="'+a.id+'"><i class="xi-close"></i></a>',i+="</div>",i+="</li>"}),i+="</ul>",i+="</div>",n.$component.find(".panel-body").html(i),n.$component.show()})}},getModalTemplate:function(){return['<div class="xe-modal fade" id="xe-draftModal">','<div class="xe-modal-dialog">','<div class="xe-modal-content">','<div class="xe-modal-header">','<button type="button" class="btn-close xe-draftBtnClose" data-dismiss="xe-modal" aria-label="Close"><i class="xi-close"></i></button>','<strong class="xe-modal-title"></strong>',"</div>",'<div class="xe-modal-body"></div>','<div class="xe-modal-footer">','<button type="button" class="xe-btn xe-btn-default" data-dismiss="xe-modal">Close</button>',"</div>","</div>","</div>","</div>"].join("\n")},getCollapseTemplate:function(){return['<div class="panel panel-default">','<div class="panel-body"></div>',"</div>"].join("\n")},appendComponent:function(){var t=this,a=e("<div>");if(e(this.container).length<1)e(this.elem).closest("form").after(a.html(this.getModalTemplate())),this.componentName="modal",this.$component=e("#xe-draftModal");else{this.componentName="collapse",this.$component=e(this.container);var n=this._collapseClass();this.$component.addClass([n,"collapse"].join(" ")).html(a.html(t.getCollapseTemplate()))}},onApply:function(t){var a=this;this.setId(t.id);var n=t.etc;n[e(a.elem).attr("name")]=t.val,i.init(e(a.elem).closest("form")[0],n),this.callback(n)},_collapseClass:function(){return"__xe_draft_collapse_"+this.uid},saveEventHandler:function(){var t=this;this.intervalClear(),this.interval=setTimeout(function(){t.setAuto(),t.intervalClear()},3e3)},intervalClear:function(){this.interval&&clearTimeout(this.interval)},draftSet:function(){""!=e.trim(e(this.elem).val())&&(null==this.draftId?this.reqPost():this.reqPut(),t.toast("success",t.Lang.trans("xe::draftSaved")))},reqPost:function(){t.ajax({url:this.apiUrl.draft.add,type:"post",dataType:"json",data:this.getReqSerialize()+"&key="+this.key,success:function(t){null===t.draftId?this.unsetId():this.setId(t.draftId)}.bind(this)})},reqPut:function(){t.ajax({url:this.apiUrl.draft.update+"/"+this.draftId,type:"post",dataType:"json",data:this.getReqSerialize(),success:function(t){var a=this;null===t.draftId&&(this.$component.find("li > a").each(function(){var t=e(this),n=t.data("item");if(n.id===a.draftId){var i=e(a.elem).val();n.val=i,n.etc.content=i,t.data("item",n).text(e(e.parseHTML(i)).text())}}),this.unsetId())}.bind(this)})},setAuto:function(){t.ajax({url:this.apiUrl.auto.set,type:"post",data:this.getReqSerialize()+"&key="+this.key})},deleteAuto:function(e){var a=this;return e=e||this.key,new Promise(function(n,i){e&&t.ajax({url:a.apiUrl.auto.unset,type:"post",data:"key="+e,success:function(){n()},error:function(t){i(t)}})})},load:function(e,a){var n=this;t.ajax({url:n.apiUrl.draft.list,type:"get",dataType:"json",data:e,success:function(t){t.forEach(function(t,e){1===t.is_auto&&(n.autoDraftId=t.id)}),a&&a(t)}})},getReqSerialize:function(){return(!0===this.withForm?e(this.elem).closest("form").serialize():[e(this.elem).attr("name"),e(this.elem).val()].join("="))+"&rep="+e(this.elem).attr("name")},reqDelete:function(e,a){var n=this;(e=e||this.draftId)&&(e==this.draftId&&(this.draftId=null),t.ajax({url:n.apiUrl.draft.delete+"/"+e,type:"post",dataType:"json",success:function(){a&&a()}}))},setId:function(t){this.draftId=t},unsetId:function(){this.draftId=null}};var i={init:function(t,e){for(var a in e){var n=a;e[a]instanceof Array?(n+="[]",this.multiple(t[n],e[a])):this.single(t[n],e[a])}},multiple:function(t,a){e(t).is(":checkbox")?e.each(a,function(e,a){this.toCheckbox(t,a)}.bind(this)):e.each(a,function(a,n){this.toInput(e(t).eq(a)[0],n)}.bind(this))},single:function(t,a){e(t).is(":checkbox")?this.toCheckbox(t,a):e(t).is(":radio")?this.toRadio(t,a):e(t).is("select")?this.toSelect(t,a):this.toInput(t,a)},toCheckbox:function(t,a){e(t).each(function(){if(e(this).attr("value")==a)return e(this).prop("checked",!0),!1})},toRadio:function(t,a){e(t).each(function(){if(e(this).attr("value")==a)return e(this).prop("checked",!0),!1})},toSelect:function(t,a){e(t).children().each(function(){if(e(this).attr("value")==a)return e(this).prop("selected",!0),!1})},toInput:function(t,a){e(t).is("input[type=hidden]")||e(t).val(a)}};e.fn.draft=function(t){var n={container:null,withForm:!1,callback:null};if(t=e.extend({},n,t),!t.key||!t.btnLoad||!t.btnSave)return console.error("must need key, btnLoad and btnSave"),!1;var i=new a(this,t.key,t.callback,t.withForm,t.container,t.apiUrl);return e(t.btnLoad).unbind("click.draft").bind("click.draft",function(t){t.preventDefault(),i.toggle(!0)}),e(t.btnSave).unbind("click.draft").bind("click.draft",function(t){t.preventDefault(),i.draftSet()}),i}}(window.XE,window.jQuery)},58:function(t,e,a){t.exports=a(0)(134)}})});